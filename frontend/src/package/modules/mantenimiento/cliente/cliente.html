<div class="card">
  <p-toast></p-toast>

  <p-toolbar styleClass="mb-4 gap-2">
    <ng-template pTemplate="left">
      <button pButton pRipple label="Nuevo Cliente" icon="pi pi-plus" class="p-button-outlined p-button-primary mr-2" (click)="openNew()"></button>
    </ng-template>

    <ng-template pTemplate="right">
      <span class="p-input-icon-left">
        <i class="pi pi-search"></i>
        <input pInputText type="text" (input)="onGlobalFilter($event)" placeholder="Buscar..." />
      </span>
    </ng-template>
  </p-toolbar>

  <p-table
    #dt
    [value]="clientes"
    [rows]="10"
    [paginator]="true"
    [globalFilterFields]="['cliente_dni', 'cliente_nombres', 'cliente_apellidos', 'cliente_correo']"
    [tableStyle]="{ 'min-width': '75rem' }"
    [(selection)]="selectedClientes"
    [rowHover]="true"
    dataKey="cliente_id"
    [loading]="loading"
    currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} clientes"
    [showCurrentPageReport]="true">

    <ng-template pTemplate="header">
      <tr>
        <th style="width: 4rem">
          <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
        </th>
        <th>Acciones</th>
        <th pSortableColumn="cliente_dni">DNI <p-sortIcon field="cliente_dni"></p-sortIcon></th>
        <th pSortableColumn="cliente_nombres">Nombres <p-sortIcon field="cliente_nombres"></p-sortIcon></th>
        <th pSortableColumn="cliente_apellidos">Apellidos <p-sortIcon field="cliente_apellidos"></p-sortIcon></th>
        <th pSortableColumn="cliente_correo">Correo <p-sortIcon field="cliente_correo"></p-sortIcon></th>
        <th pSortableColumn="cliente_celular">Celular <p-sortIcon field="cliente_celular"></p-sortIcon></th>
        <th pSortableColumn="cliente_distrito">Distrito <p-sortIcon field="cliente_distrito"></p-sortIcon></th>
        <th>Estado</th>

      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-cliente>
      <tr>
        <td>
          <p-tableCheckbox [value]="cliente"></p-tableCheckbox>
        </td>
        <td>
            <p-button icon="pi pi-pencil" severity="info" [outlined]="true"
                            pTooltip="Editar" tooltipPosition="top" [rounded]="true" size="large"
                            styleClass="border-2 mr-1" (click)="editCliente(cliente)"></p-button>

            <p-button icon="pi pi-trash" severity="danger" [outlined]="true"
                pTooltip="Eliminar" tooltipPosition="top" [rounded]="true" size="large"
                styleClass="border-2 mr-1" (click)="deleteCliente(cliente)" ></p-button>
        </td>
        <td>{{ cliente.cliente_dni }}</td>
        <td>{{ cliente.cliente_nombres }}</td>
        <td>{{ cliente.cliente_apellidos }}</td>
        <td>{{ cliente.cliente_correo || '-' }}</td>
        <td>{{ cliente.cliente_celular || '-' }}</td>
        <td>{{ cliente.cliente_distrito || '-' }}</td>
        <td>
          <span [class]="'badge ' + (cliente.cliente_estado === 1 ? 'badge-success' : 'badge-danger')">
            {{ cliente.cliente_estado === 1 ? 'Activo' : 'Inactivo' }}
          </span>
        </td>

      </tr>
    </ng-template>

    <ng-template pTemplate="emptymessage">
      <tr>
        <td colspan="9">No se encontraron clientes.</td>
      </tr>
    </ng-template>
  </p-table>
</div>

<p-dialog
  [(visible)]="clienteDialog"
  [style]="{ width: '550px' , 'margin': '15px'  }"
  [header]="cliente.cliente_id ? 'Editar Cliente' : 'Nuevo Cliente'"
  [modal]="true"
  styleClass="p-fluid">

  <ng-template pTemplate="content">
    <div class="p-fluid grid formgrid">
        <div class="field">
        <label for="dni">DNI <span style="color: red">*</span></label>
        <input type="text" class="w-full" pInputText id="dni" [(ngModel)]="cliente.cliente_dni" required autofocus />
        <small class="p-error" *ngIf="submitted && !cliente.cliente_dni">El DNI es requerido.</small>
        </div>

        <div class="field">
        <label for="nombres">Nombres <span style="color: red">*</span></label>
        <input type="text" class="w-full" pInputText id="nombres" [(ngModel)]="cliente.cliente_nombres" required />
        <small class="p-error" *ngIf="submitted && !cliente.cliente_nombres">Los nombres son requeridos.</small>
        </div>

        <div class="field">
        <label for="apellidos">Apellidos <span style="color: red">*</span></label>
        <input type="text" class="w-full" pInputText id="apellidos" [(ngModel)]="cliente.cliente_apellidos" required />
        <small class="p-error" *ngIf="submitted && !cliente.cliente_apellidos">Los apellidos son requeridos.</small>
        </div>

        <div class="field">
        <label for="correo">Correo Electrónico</label>
        <input type="email" class="w-full" pInputText id="correo" [(ngModel)]="cliente.cliente_correo" />
        </div>

        <div class="field">
        <label for="celular">Celular</label>
        <input type="text" class="w-full" pInputText id="celular" [(ngModel)]="cliente.cliente_celular" />
        </div>

        <div class="field">
        <label for="direccion">Dirección</label>
        <input type="text" class="w-full" pInputText id="direccion" [(ngModel)]="cliente.cliente_direccion" />
        </div>

        <div class="field">
        <label for="distrito">Distrito</label>
        <input type="text" class="w-full" pInputText id="distrito" [(ngModel)]="cliente.cliente_distrito" />
        </div>
    </div>
  </ng-template>

  <ng-template pTemplate="footer">
    <button pButton pRipple label="Cancelar" icon="pi pi-times" class="p-button-text" (click)="hideDialog()"></button>
    <button pButton pRipple label="Guardar" icon="pi pi-check" class="p-button-text" (click)="saveCliente()"></button>
  </ng-template>
</p-dialog>

<p-confirmDialog [style]="{ width: '450px' }"></p-confirmDialog>
