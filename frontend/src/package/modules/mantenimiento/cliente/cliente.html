<div class="card">
  <p-toast></p-toast>
  
  <p-toolbar styleClass="mb-4 gap-2">
    <ng-template pTemplate="left">
      <button pButton pRipple label="Nuevo Cliente" icon="pi pi-plus" class="p-button-success mr-2" (click)="openNew()"></button>
    </ng-template>

    <ng-template pTemplate="right">
      <span class="p-input-icon-left">
        <i class="pi pi-search"></i>
        <input pInputText type="text" (input)="onGlobalFilter($event)" placeholder="Buscar..." />
      </span>
    </ng-template>
  </p-toolbar>

  <p-table 
    #dt 
    [value]="clientes" 
    [rows]="10" 
    [paginator]="true"
    [globalFilterFields]="['cliente_dni', 'cleinte_nombres', 'cliente_apellidos', 'cliente_correo']"
    [tableStyle]="{ 'min-width': '75rem' }"
    [(selection)]="selectedClientes"
    [rowHover]="true"
    dataKey="cliente_id"
    [loading]="loading"
    currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} clientes"
    [showCurrentPageReport]="true">
    
    <ng-template pTemplate="header">
      <tr>
        <th style="width: 4rem">
          <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
        </th>
        <th pSortableColumn="cliente_dni">DNI <p-sortIcon field="cliente_dni"></p-sortIcon></th>
        <th pSortableColumn="cleinte_nombres">Nombres <p-sortIcon field="cleinte_nombres"></p-sortIcon></th>
        <th pSortableColumn="cliente_apellidos">Apellidos <p-sortIcon field="cliente_apellidos"></p-sortIcon></th>
        <th pSortableColumn="cliente_correo">Correo <p-sortIcon field="cliente_correo"></p-sortIcon></th>
        <th pSortableColumn="cliente_celular">Celular <p-sortIcon field="cliente_celular"></p-sortIcon></th>
        <th pSortableColumn="cliente_distrito">Distrito <p-sortIcon field="cliente_distrito"></p-sortIcon></th>
        <th>Estado</th>
        <th>Acciones</th>
      </tr>
    </ng-template>
    
    <ng-template pTemplate="body" let-cliente>
      <tr>
        <td>
          <p-tableCheckbox [value]="cliente"></p-tableCheckbox>
        </td>
        <td>{{ cliente.cliente_dni }}</td>
        <td>{{ cliente.cleinte_nombres }}</td>
        <td>{{ cliente.cliente_apellidos }}</td>
        <td>{{ cliente.cliente_correo || '-' }}</td>
        <td>{{ cliente.cliente_celular || '-' }}</td>
        <td>{{ cliente.cliente_distrito || '-' }}</td>
        <td>
          <span [class]="'badge ' + (cliente.cliente_estado === 1 ? 'badge-success' : 'badge-danger')">
            {{ cliente.cliente_estado === 1 ? 'Activo' : 'Inactivo' }}
          </span>
        </td>
        <td>
          <button pButton pRipple icon="pi pi-pencil" class="p-button-rounded p-button-success mr-2" (click)="editCliente(cliente)"></button>
          <button pButton pRipple icon="pi pi-trash" class="p-button-rounded p-button-warning" (click)="deleteCliente(cliente)"></button>
        </td>
      </tr>
    </ng-template>
    
    <ng-template pTemplate="emptymessage">
      <tr>
        <td colspan="9">No se encontraron clientes.</td>
      </tr>
    </ng-template>
  </p-table>
</div>

<p-dialog 
  [(visible)]="clienteDialog" 
  [style]="{ width: '550px' }" 
  header="Detalle del Cliente" 
  [modal]="true" 
  styleClass="p-fluid">
  
  <ng-template pTemplate="content">
    <div class="field">
      <label for="dni">DNI *</label>
      <input type="text" pInputText id="dni" [(ngModel)]="cliente.cliente_dni" required autofocus />
      <small class="p-error" *ngIf="submitted && !cliente.cliente_dni">El DNI es requerido.</small>
    </div>

    <div class="field">
      <label for="nombres">Nombres *</label>
      <input type="text" pInputText id="nombres" [(ngModel)]="cliente.cleinte_nombres" required />
      <small class="p-error" *ngIf="submitted && !cliente.cleinte_nombres">Los nombres son requeridos.</small>
    </div>

    <div class="field">
      <label for="apellidos">Apellidos *</label>
      <input type="text" pInputText id="apellidos" [(ngModel)]="cliente.cliente_apellidos" required />
      <small class="p-error" *ngIf="submitted && !cliente.cliente_apellidos">Los apellidos son requeridos.</small>
    </div>

    <div class="field">
      <label for="correo">Correo Electrónico</label>
      <input type="email" pInputText id="correo" [(ngModel)]="cliente.cliente_correo" />
    </div>

    <div class="field">
      <label for="celular">Celular</label>
      <input type="text" pInputText id="celular" [(ngModel)]="cliente.cliente_celular" />
    </div>

    <div class="field">
      <label for="direccion">Dirección</label>
      <input type="text" pInputText id="direccion" [(ngModel)]="cliente.cliente_direccion" />
    </div>

    <div class="field">
      <label for="distrito">Distrito</label>
      <input type="text" pInputText id="distrito" [(ngModel)]="cliente.cliente_distrito" />
    </div>
  </ng-template>

  <ng-template pTemplate="footer">
    <button pButton pRipple label="Cancelar" icon="pi pi-times" class="p-button-text" (click)="hideDialog()"></button>
    <button pButton pRipple label="Guardar" icon="pi pi-check" class="p-button-text" (click)="saveCliente()"></button>
  </ng-template>
</p-dialog>

<p-confirmDialog [style]="{ width: '450px' }"></p-confirmDialog>
